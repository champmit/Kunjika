map function:

function (doc, meta) {
  if(doc._type == 'a') {
    for(i=0; i<doc.tags.length; i++) {
      emit(doc.tags[i], null);
    }
  }
}

reduce function:

function(key, values, rereduce) {
  var sum = 0;
  var dict = {};
  for(k in key) {
    if(dict[key[k]] != 1) {
	sum += 1;
      dict[key[k]] = 1;
    }
  }
  return sum;
}
